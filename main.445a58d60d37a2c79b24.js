!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){},function(t,e,i){"use strict";i.r(e);i(0);var s=class{constructor({x:t,y:e}){this.x=t,this.y=e,this.isDead=!1}isCollides(t){return this.x===t.x&&this.y===t.y}dead(){this.isDead=!0}};var o=class extends s{constructor({x:t,y:e,owner:i}){super({x:t,y:e})}render({ctx:t,size:e}){t.fillStyle="#ff0000",t.fillRect(this.x*e,this.y*e,e,e)}};var n=class extends s{constructor({x:t,y:e,owner:i}){super({x:t,y:e}),this.color="#ff0000",this.lastStepTime=0,this.velocity=80}render({ctx:t,size:e}){const i=Date.now();i-this.lastStepTime>this.velocity&&(this.lastStepTime=i,this.color="#ff0000"===this.color?"#00ff00":"#ff0000"),t.fillStyle=this.color,t.fillRect(this.x*e,this.y*e,e,e)}};var h=class extends s{constructor({x:t,y:e,owner:i}){super({x:t,y:e}),this.owner=i,this.hasFood=!1}render({ctx:t,size:e}){t.fillStyle=this.hasFood?"#ff00ff":"#0000ff",t.fillRect(this.x*e,this.y*e,e,e)}};const r="Up",a="Down",c="Left",d="Right";var l=class{constructor({x:t,y:e,velocity:i,direction:s}){this.velocity=i,this.direction=s,this.body=[new h({x:t,y:e,owner:this})],this.lastStepTime=0}eat(t){if(t instanceof h){const e=t.owner.body.indexOf(t);t.owner.body=t.owner.body.slice(0,e)}if(t instanceof o&&(t.dead(),this.body[0].hasFood=!0),t instanceof n){t.dead(),this.body[0].hasFood=!0;const e=this.velocity;this.velocity*=.5,setTimeout(()=>this.velocity=e,5e3)}}calculateStep(){const t=this.body[0];if([r,a].includes(this.direction)){const e=this.direction===r?t.y-1:t.y+1;return new h({x:t.x,y:e,owner:this})}if([c,d].includes(this.direction)){const e=this.direction===c?t.x-1:t.x+1;return new h({x:e,y:t.y,owner:this})}}step(){const t=Date.now();if(t-this.lastStepTime>this.velocity){this.lastStepTime=t;const e=this.calculateStep(),i=this.body.slice(-1)[0];this.body=[e,...this.body.slice(0,-1)],i.hasFood&&(console.log("keep last item"),i.hasFood=!1,this.body.push(i))}}render({ctx:t,size:e}){this.body.forEach(i=>i.render({ctx:t,size:e}))}setDirection(t){this.direction===a&&t===r||this.direction===r&&t===a||this.direction===c&&t===d||this.direction===d&&t===c||(this.direction=t)}};(new class{constructor(){this.canvas=document.getElementById("canvas"),this.resizeCanvas(),this.ctx=this.canvas.getContext("2d"),this.itemSize=Math.floor(Math.max(this.canvas.width,this.canvas.height)/100),this.maxHeight=this.canvas.height/this.itemSize,this.maxWidth=this.canvas.width/this.itemSize,this.setupEventHandlers(),this.paused=!1,this.gameEnded=!1}run(){this.gameEnded=!1,this.food=this.generateFood(),this.powerUp=null,this.snake=new l({x:Math.floor(this.maxWidth/2),y:Math.floor(this.maxHeight/2),velocity:80,direction:d}),window.requestAnimationFrame(this.render.bind(this))}gameOver(){this.gameEnded=!0}setupEventHandlers(){document.addEventListener("keydown",({code:t})=>{if(this.gameEnded)this.run();else switch(t){case"KeyW":case"ArrowUp":!this.paused&&this.snake.setDirection(r);break;case"KeyS":case"ArrowDown":!this.paused&&this.snake.setDirection(a);break;case"KeyA":case"ArrowLeft":!this.paused&&this.snake.setDirection(c);break;case"KeyD":case"ArrowRight":!this.paused&&this.snake.setDirection(d);break;case"Space":this.paused=!this.paused}}),window.addEventListener("resize",this.resizeCanvas.bind(this))}resizeCanvas(){this.canvas.width=this.canvas.clientWidth*(window.devicePixelRatio||1),this.canvas.height=this.canvas.clientHeight*(window.devicePixelRatio||1),this.maxHeight=this.canvas.height/this.itemSize,this.maxWidth=this.canvas.width/this.itemSize}getRandomCoord(){return{x:Math.floor(Math.random()*this.maxWidth),y:Math.floor(Math.random()*this.maxHeight)}}generateFood(t){const{x:e,y:i}=this.getRandomCoord();return t?new n({x:e,y:i}):new o({x:e,y:i})}render(t){if(!this.paused){this.food.isDead&&(this.food=this.generateFood(!1),(!this.powerUp||this.powerUp.isDead)&&Math.random()<.8&&(this.powerUp=this.generateFood(!0))),this.snake.step();const t=this.snake.body[0];if(t.x>this.maxWidth||t.x<0||t.y>this.maxHeight||t.y<0)return void this.gameOver();this.food.isCollides(t)&&this.snake.eat(this.food),this.powerUp&&!this.powerUp.isDead&&this.powerUp.isCollides(t)&&this.snake.eat(this.powerUp),this.snake.body.slice(1).forEach(e=>{e.isCollides(t)&&this.snake.eat(e)}),this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.snake.render({ctx:this.ctx,size:this.itemSize}),this.food.render({ctx:this.ctx,size:this.itemSize}),this.powerUp&&!this.powerUp.isDead&&this.powerUp.render({ctx:this.ctx,size:this.itemSize})}this.gameEnded||window.requestAnimationFrame(this.render.bind(this))}}).run()}]);